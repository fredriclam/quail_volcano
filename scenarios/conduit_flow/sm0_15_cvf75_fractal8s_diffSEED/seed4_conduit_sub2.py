''' Input file generated by generate_conduit_partitions.py. '''

import numpy as np
import scipy.interpolate as si

def fractal_timeSeries(end_time, dt, SEED, Ch, max_freq):
  t = np.linspace(0,end_time+dt,int((end_time+dt) / dt))

  N = len(t) # number of Fourier sample points
  h = t[1]-t[0] # grid spacing, nominally h=0.1 km for r=1
  L = N*h # profile length

  # white noise, unit normal distribution
  randomGen = np.random.default_rng(seed=SEED)
  y = randomGen.normal(size=N)
  # scale so PSD has unit amplitude
  y = y*np.sqrt(N/L)

  omega = 2 * np.pi * np.fft.fftfreq(N, h)
  Y = np.fft.fft(y)*h

  # apply fractal PSD
  PSD_fractal = Ch * np.abs(omega)**(-3)
  PSD_fractal[np.abs(omega) > max_freq * 2 * np.pi] = 0

  Y_fractal = Y * np.sqrt(PSD_fractal)
  Y_fractal[0] = 0
  Y_fractal[-1] = 0
  PSDy_fractal = np.abs(Y_fractal)**2/L

  # transforming back into time domain
  y_fractal = np.fft.ifft(Y_fractal) / h
  y_fractal = np.real(y_fractal) - np.real(y_fractal)[0]

  fractal = si.interp1d(t, y_fractal, kind='cubic', bounds_error=False, fill_value="extrapolate")
  return fractal

CH = (2 * np.pi)**3 * (4 * 10**(-5))**2

Numerics = {'AVParameter': 0.3,
 'ApplyLimiters': 'PositivityPreservingMultiphasevpT',
 'ArtificialViscosity': True,
 'ElementQuadrature': 'GaussLegendre',
 'FaceQuadrature': 'GaussLegendre',
 'L2InitialCondition': True,
 'SolutionBasis': 'LagrangeSeg',
 'SolutionOrder': 2,
 'Solver': 'DG'}

Mesh = {'ElementShape': 'Segment',
 'File': None,
 'NumElemsX': 200,
 'xmax': -850.0,
 'xmin': -950.0}

Physics = {'ConvFluxNumerical': 'LaxFriedrichs',
 'Gas1': {'R': 287.0, 'gamma': 1.4},
 'Gas2': {'R': 461.3762486126526, 'c_p': 2288.0},
 'Liquid': {'E_m0': 0,
            'K': 10000000000.0,
            'c_m': 3000.0,
            'p0': 35999999.99999999,
            'rho0': 2600.0},
 'Solubility': {'k': 5e-06, 'n': 0.5},
 'Type': 'MultiphasevpT',
 'Viscosity': {'mu0': 300000.0},
 'tau_d': 1.0}

SourceTerms = {'source1': {'Function': 'GravitySource',
             'gravity': 9.8,
             'source_treatment': 'Explicit'},
 'source2': {'Function': 'FrictionVolFracVariableMu',
             'conduit_radius': 50,
             'source_treatment': 'Explicit'},
 'source3': {'Function': 'ExsolutionSource',
             'source_treatment': 'Explicit',
             'tau_d': 10.0},
 'source4': {'Function': 'FragmentationTimescaleSourceSmoothed',
             'crit_volfrac': 0.75,
             'fragsmooth_scale': 0.15,
             'source_treatment': 'Explicit',
             'tau_f': 1.0}}

Output = {'AutoPostProcess': False,
 'Prefix': '/scratch/users/kcoppess/pressureBC/sm0_15_cvf75/fractal8s_diffSEED/conduit_sub2_seed4',
 'WriteInitialSolution': True,
 'WriteInterval': 540}

InitialCondition = {'Function': 'SteadyState',
 'K_magma': 10000000000.0,
 'T_chamber': 1050,
 'approx_massfracs': True,
 'c_v_magma': 3000.0,
 'conduit_radius': 50,
 'crit_volfrac': 0.75,
 'fragsmooth_scale': 0.15,
 'inlet_input_val': 40000000.0,
 'input_type': 'p',
 'neglect_edfm': True,
 'p0_magma': 35999999.99999999,
 'p_vent': 100000.0,
 'rho0_magma': 2600.0,
 'solubility_k': 5e-06,
 'solubility_n': 0.5,
 'tau_d': 10.0,
 'tau_f': 1.0,
 'x_global': np.unique(np.hstack([np.linspace(-1.150e+03, -1.050e+03, 401), np.linspace(-1.050e+03, -9.500e+02, 401), np.linspace(-9.500e+02, -8.500e+02, 401), np.linspace(-8.500e+02, -7.500e+02, 401), np.linspace(-7.500e+02, -6.500e+02, 401), np.linspace(-6.500e+02, -5.500e+02, 401), np.linspace(-5.500e+02, -4.500e+02, 401), np.linspace(-4.500e+02, -3.500e+02, 401), np.linspace(-3.500e+02, -2.500e+02, 401), np.linspace(-2.500e+02, -1.500e+02, 401)])),
 'yA': 1e-07,
 'yC': lambda t: 0.4,
 'yCMin': 1e-05,
 'yWt': lambda t: 0.03 * (1.0 - 0.4) / (1.0 + 0.03),
 'yWvInletMin': 1e-05}

ExactSolution = {'Function': 'RiemannProblem'}

BoundaryConditions = {'x1': {'BCType': 'MultiphasevpT1D1D', 'bkey': 'comm1D_1_2'},
 'x2': {'BCType': 'MultiphasevpT1D1D', 'bkey': 'comm1D_2_3'}}

LinkedSolvers = [{'BoundaryName': 'comm1D_2_3', 'DeckName': 'seed4_conduit_sub3.py'}]

